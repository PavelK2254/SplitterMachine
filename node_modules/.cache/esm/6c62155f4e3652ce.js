let MongoClient;_4e3‍.x([["init",()=>init],["addNewOrdersToDB",()=>addNewOrdersToDB]]);_4e3‍.w("mongodb",[["MongoClient",["MongoClient"],function(v){MongoClient=v}]]);const collectionName = "ordersTest";
const options = { useNewUrlParser: false, useUnifiedTopology: false };
const dbName = 'splitterDB'

var url = "mongodb://localhost:27017/" + dbName;
var availableCollections = [];

       function init() {
    return new Promise(function(resolve, reject) {
        MongoClient.connect(url, options, function(err, db) {
            if (err) {
                reject(err)
            };
            var dbo = db.db(dbName);

            dbo.listCollections().toArray(function(err, items) {
                if (err) {
                    reject(err)
                };
                availableCollections = items;
                if (items.length == 0) {
                    console.log(`No collections in database, creating ${collectionName}`)
                    dbo.createCollection(collectionName, function(err, res) {
                        if (err) {
                            reject(err)
                        };
                        resolve(`Collection created! ${collectionName}`);
                        db.close();
                    });
                } else {
                    resolve(`Collection ${collectionName} Is available`);

                }

            });
        });
    })

}

       function addNewOrdersToDB(order) {
    return new Promise(function(resolve, reject) {
        MongoClient.connect(url, options, function(err, db) {
            if (err) throw err;
            var dbo = db.db("mydb");
            var newOrder = order;

            dbo.collection("customers").insertMany(newOrder, function(err, res) {
                if (err) {
                    db.close();
                    reject(err);
                    _4e3‍.g.console.log(err);

                } else {

                    //console.log(`${order.id} inserted`);
                    resolve(res);
                    db.close();
                }
            });
        });
    })

}