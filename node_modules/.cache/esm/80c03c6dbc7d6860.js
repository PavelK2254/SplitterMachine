let net,Socket,parseOrderData;_bc7‍.x([["initTcpServer",()=>initTcpServer]]);_bc7‍.w("net",[["default",["net"],function(v){net=v}],["Socket",["Socket"],function(v){Socket=v}]]);_bc7‍.w("../Controller/orderParser",[["parseOrderData",["parseOrderData"],function(v){parseOrderData=v}]]);


const port = 1337;
const hostName = '0.0.0.0';
const tcpServer = new net.createServer();


       function initTcpServer() {


    tcpServer.on('connection', (socket) => {
        _bc7‍.g.console.log('A new connection has been established. local address: ' + socket.localAddress);
        socket.write('Echo server\r\n');
        socket.on('error', (err) => {
            _bc7‍.g.console.log('socket error ' + err.stack);
        })
        socket.on('data', (data) => {
            var textChunk = data.toString('utf8');
            console.log(`recieved ${textChunk}`);
            parseOrderData(textChunk).then((result) => {
                console.log(`Returning result: ${JSON.stringify(result)}`);
                socket.write(JSON.stringify(result));
            }).catch((reason) => {
                socket.write(JSON.stringify(reason));
            })
        })

        socket.on('close', (hadError) => {
            _bc7‍.g.console.log('connection closed had error?: ' + hadError);
        })


        socket.on('end', () => {
            console.log('Socket connection ended');

        })

    })

    tcpServer.listen(port, hostName, () => {
        _bc7‍.g.console.log(`Server listening for connection requests on socket port ${port}`, tcpServer.address());
    });
   
};